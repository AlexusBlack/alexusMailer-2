function ChangePass(a,b){$.post("%PHP_SELF%?changepass",{login:a,pass:b},function(a){var b=$.parseJSON(a);"ok"==b.result?$("#passchangesuccess").show():$("#passchangeerror").show()})}function pingoutservers(){var a=$("#out_servers").val();if(""!=a){window.pingout_servers=a.split("\n"),window.pingout_servers_todo=window.pingout_servers.length,$("#out_servers").val(""),$("#pingout_log").html(""),update_pingoutprogress();for(var b=0;4>b;b++)pingout_server()}}function pingout_server(){if(0!=window.pingout_servers.length){var a=window.pingout_servers.pop();$.post("%PHP_SELF%?pingoutserver",{server:a},function(a){var b=$.parseJSON(a),c=$("#pingout_log").html();"GOOD"==b.status?($("#pingout_log").html(c+"<span style='color:green;'>"+b.server+" работает</span><br>"),$("#out_servers").val($("#out_servers").val()+b.server+"\n")):$("#pingout_log").html(c+"<span style='color:red;'>"+b.server+" %error%: "+b.error+"</span><br>"),$("#pingout_log").scrollTop($("#pingout_log").prop("scrollHeight")),update_pingoutprogress(),setTimeout(pingout_server,0)})}}function update_pingoutprogress(){var a=window.pingout_servers_todo-window.pingout_servers.length,b=$("#outprogressbar");$(b).find(".barcounter").text(a+"/"+window.pingout_servers_todo);var c=parseInt(a/(window.pingout_servers_todo/100));$(b).find(".bar").css("width",c+"%")}function Send(){if(cleValidate(),$("#sendInBackground").is(":checked"))return lastSendWasBackground=!0,SendInBackground();lastSendWasBackground=!1,enumer=0,$("#use_out_servers").is(":checked")?(outServers.updateServers(),outServers.active=!0):outServers.active=!1;var a=$("#to").val().match(/\[FILE:(.+?)\]/);if(null!=a){var b=a[0],c=a[1];$.post("?linesinfile",{file_path:c},function(a){var c=parseInt(a);toDo=[];for(var d=0;c>d;d++)toDo.push(b);toDoSize=toDo.length,SetProgressBar(0,"0/"+toDoSize),ResumeSendMail()})}else{toDo=$("#to").val().split("\n");var d=parseInt($("#testEmailCounter").val());if(d>0){var e=$("#testEmail").val();toDo=mixToArchive(toDo,e,d)}toDoSize=toDo.length,SetProgressBar(0,"0/"+toDoSize),ResumeSendMail()}}function SendInBackground(){var a=$("#to").val(),b=parseInt($("#testEmailCounter").val());if(b>0){var c=$("#testEmail").val();toDo=a.split("\n"),toDo=mixToArchive(toDo,c,b),a=toDo.join("\n")}var d={to:$("#to").val(),fromname:$("#fromname").val(),frommail:$("#frommail").val(),replymail:$("#replymail").val(),subject:$("#tema").val(),text:$("#text").val(),type:$("#type").val(),files:JSON.stringify(attachedFiles),timeout:timeoutNum,randomTimeout:$("#randomTimeout").is(":checked"),sendInBase64:$("#sendInBase64").is(":checked"),saveLogInTxt:$("#saveLogInTxt").is(":checked")};$("#use_out_servers").is(":checked")&&(d.outservers=$("#out_servers").val());var e=new Array;$(".additional").each(0==e.length?function(){e.push(ReplaceEnum($(this).val()))}:function(a){a<e.length||e.push(ReplaceEnum($(this).val()))});for(i in e)d["additional["+i+"]"]=e[i];$.post("?sendInBackground",d),clearInterval(window.backgroudStateChecker),window.backgroudStateChecker=setInterval(updateBackgroundState,5e3)}function updateBackgroundState(){$.post("?getBackgroundState",function(a){if("null"!=a){try{var b=$.parseJSON(a)}catch(c){return void console.log(c)}if(void 0!=b.log){var d=b.log.split("\n");for(var e in d)if(""!=d[e]){var f=d[e].split("|");void 0==window.lastBackgroundLogUpdate&&(window.lastBackgroundLogUpdate=0),window.lastBackgroundLogUpdate<f[0]&&(window.lastBackgroundLogUpdate=f[0],AddDone(f[1]),DrawDone())}}0==b.isRunning?(lastSendWasBackground&&SetProgressBar(b.position/(b.count/100),b.position+"/"+b.count),$("#mainSendButton").prop("disabled",!1),$("#StopSendMail").prop("disabled",!0),$(".status span").removeClass("label-success label-danger").addClass("label-warning").text("%status-idle%")):(SetProgressBar(b.position/(b.count/100),b.position+"/"+b.count),$("#mainSendButton").prop("disabled",!0),$("#StopSendMail").prop("disabled",!1),$(".status span").removeClass("label-danger label-warning").addClass("label-success").text("%status-sending%"))}})}function stopBackgroundSend(){$.post("?setBackgroundState",{isRunning:!1})}function PauseSendMail(){status="pause",$("#PauseSendMail").prop("disabled",!0),$("#ResumeSendMail, #StopSendMail").prop("disabled",!1),$(".status span.tr-status-idle").removeClass("label-success label-warning").addClass("label-danger").text("%status-pause%")}function ResumeSendMail(){status="start",$("#ResumeSendMail").prop("disabled",!0),$("#PauseSendMail, #StopSendMail").prop("disabled",!1),$(".status span.tr-status-idle").removeClass("label-danger label-warning").addClass("label-success").text("%status-sending%");for(var a=0;threadNum>a;a++)SendMail()}function StopSendMail(){$("#sendInBackground").is(":checked")&&stopBackgroundSend(),status="stop",StopSendMailHandler()}function Preview(){cleValidate();var a={to:"null@null.null",fromname:ReplaceEnum($("#fromname").val(),!1),frommail:ReplaceEnum($("#frommail").val(),!1),replymail:ReplaceEnum($("#replymail").val(),!1),tema:ReplaceEnum($("#tema").val(),!1),type:$("#type").val(),text:ReplaceEnum($("#text").val()),enumer:toDoSize-toDo.length};$(".additional").each(0==additional.length?function(){additional.push(ReplaceEnum($(this).val()))}:function(a){a<additional.length||additional.push(ReplaceEnum($(this).val()))});for(i in additional)a["additional["+i+"]"]=additional[i];$.post("%PHP_SELF%?preview",a,function(a){showPreviewWindow("text"==$("#type").val()?"data:text/plain;charset=utf-8;base64,"+Base64.encode(a):"data:text/html;charset=utf-8;base64,"+Base64.encode(a))})}function StopSendMailHandler(){$(".status span.tr-status-idle").removeClass("label-success label-danger").addClass("label-warning").text("%status-idle%"),$(".status .btn").prop("disabled",!0)}function SendMail(){if("pause"!=status&&"stop"!=status){if(0==toDo.length)return status="stop",void StopSendMailHandler();var a=toDo.pop();if(additional=new Array,-1!=a.indexOf(";")){var b=a.split(";");for(var c in b)0==c?a=b[0]:additional.push(b[c])}var d={to:a,fromname:ReplaceEnum($("#fromname").val(),!1),frommail:ReplaceEnum($("#frommail").val(),!1),replymail:ReplaceEnum($("#replymail").val(),!1),tema:ReplaceEnum($("#tema").val(),!1),type:$("#type").val(),captcha_code:$("input[name=captcha_code]").val(),text:ReplaceEnum($("#text").val()),enumer:toDoSize-toDo.length,sendInBase64:$("#sendInBase64").is(":checked"),saveLogInTxt:$("#saveLogInTxt").is(":checked")};if($("#use_proxy_server").is(":checked")&&(d.PROXY=$("#proxy_server_uri").val(),d.PROXY)){var e=d.PROXY.split("\n");e.length>1&&(d.PROXY=e[d.enumer%e.length])}0!=attachedFiles.length&&(d.files=JSON.stringify(attachedFiles)),$(".additional").each(0==additional.length?function(){additional.push(ReplaceEnum($(this).val()))}:function(a){a<additional.length||additional.push(ReplaceEnum($(this).val()))});for(i in additional)d["additional["+i+"]"]=additional[i];outServers.active&&(d.outserver=outServers.getServer()),$.post("%PHP_SELF%?send",d,function(a){if(window.alexusMailerServiceMode){if("CAPTCHA ERROR"==a)return $("#console").html("%badcaptcha%"),$("#console").css("background-color","Tomato"),void(document.getElementById("captcha").src="/securimage/securimage_show.php?"+Math.random());if("OUT OF LIMIT"==a)return $("#console").html("%sendlimit%"),$("#console").css("background-color","Tomato"),void(document.getElementById("captcha").src="/securimage/securimage_show.php?"+Math.random());document.getElementById("captcha").src="/securimage/securimage_show.php?"+Math.random()}$("#console").html(a.replace("<","&lt;").replace(">","&gt;")),$("#console").css("background-color","YellowGreen");var b=a.split(" ");AddDone(b.length>3?b[3].replace("<","").replace(">",""):b[2]),DrawDone(),SetProgressBar((toDoSize-toDo.length)/(toDoSize/100),toDoSize-toDo.length+"/"+toDoSize),0==timeoutNum?SendMail():(ctimeoutNum=timeoutNum,$("#randomTimeout").is(":checked")&&(ctimeoutNum+=getRandomInt(-3,3),0>ctimeoutNum&&(timeoutNum=0)),setTimeout(function(){SendMail()},1e3*ctimeoutNum))})}}function SetProgressBar(a,b){parseInt($("#progressbar").css("width"))/100;$("#progressbar .bar").css("width",a+"%"),$("#progressbar .barcounter").text(b)}function AddDone(a){Done.length>maxDoneSize&&Done.splice(0,1),Done.push(a)}function DrawDone(){$("#ext-console").html("");var a="";for(i in Done)a=Done[i]+"<br>"+a;$("#ext-console").html(a)}function ShowThreads(){$("#THREADS").text(threadNum)}function showUniversalUpload(){"none"==$("#univarsalUpload").css("display")?($("#univarsalUpload").find("iframe").attr("src","%PHP_SELF%?upload_universal"),$("#univarsalUpload").modal("show")):$("#univarsalUpload").modal("hide")}function UploadClickHandler(a){$(a).parent().parent().find("iframe").contents().find("form").submit()}function attachFileHandler(a){if(null!=a){var b=$.parseJSON(Base64.decode(a));attachedFiles.push(b),updateFileList(),$("#univarsalUpload").modal("hide")}}function showAttachUpload(){$("#univarsalUpload").find("h4").html("%attachfile%"),window.uploadFinishedHandler=attachFileHandler,showUniversalUpload()}function updateFileList(){$("#attachedFiles").html("");var a=0;for(var b in attachedFiles)null!=attachedFiles[b]&&"remove"!=b&&($("#attachedFiles").html($("#attachedFiles").html()+(0!=a?"<br>":"")+"<i class='glyphicon glyphicon-file'></i> "+attachedFiles[b].name+" <button class='btn btn-default' onclick='removeFile("+b+");return false'>%delete%</button>"),a++)}function removeFile(a){delete attachedFiles[a],updateFileList()}function uploadListField(a){$("#univarsalUpload").find("h4").html("%uploadlist%"),window.uploadFinishedHandler=uploadListFieldHandler,$(a).addClass("uploadListField"),showUniversalUpload()}function uploadListFieldHandler(a){if(null!=a){var b=$.parseJSON(Base64.decode(a));$(".uploadListField").val(Base64.decode(b.content)),$(".uploadListField").removeClass("uploadListField"),$("#univarsalUpload").modal("hide")}}function uploadTemplate(){$("#univarsalUpload").find("h4").html("%uploadtemplate%"),window.uploadFinishedHandler=uploadTemplateHandler,showUniversalUpload()}function uploadTemplateHandler(a){if(null!=a){var b=$.parseJSON(Base64.decode(a));LoadTemplate(Base64.decode(b.content)),$("#univarsalUpload").modal("hide")}}function loadsave(a){var b=a.split("[TEXT]");$("#text").val(b[1].replaceAll("&amp;","&")),b=b[0].split("\n");for(var c in b)if(-1!=b[c].indexOf("[FROM-NAME]"))b[c]=b[c].replace("[FROM-NAME]",""),$("#fromname").val(b[c]);else if(-1!=b[c].indexOf("[FROM-EMAIL]"))b[c]=b[c].replace("[FROM-EMAIL]",""),$("#frommail").val(b[c]);else if(-1!=b[c].indexOf("[THEME]"))b[c]=b[c].replace("[THEME]",""),$("#tema").val(b[c]);else if(-1!=b[c].indexOf("[TYPE]"))b[c]=b[c].replace("[TYPE]",""),$("#type [value='"+b[c]+"']").attr("selected","selected");else if(-1!=b[c].indexOf("[FILES]"))b[c]=b[c].replace("[FILES]",""),attachedFiles=$.parseJSON(b[c]),updateFileList();else if(-1!=b[c].indexOf("[ADD")){var d=/\[ADD(\d+)\]/.exec(b[c]);AddNum<=d[1]&&AddField($(".addfield:last")),b[c]=b[c].replace(d[0],""),$("#additional"+d[1]).val(b[c])}}function LoadTemplate(a){try{var b=$.parseJSON(a)}catch(c){return console.log(c),console.log("Using old template format"),loadsave(a),void window.cle.updateFrame()}$("#text").val(Base64.decode(b.text)),$("#fromname").val(b.fromname),$("#frommail").val(b.frommail),$("#replymail").val(b.replymail),$("#tema").val(b.subject),$("#type [value='"+b.type+"']").attr("selected","selected"),null!=b.files&&(attachedFiles=b.files,updateFileList());for(var d in b.additional)d>=AddNum&&AddField($(".addfield:last")),$("#additional"+d).val(b.additional[d]);window.cle.updateFrame()}function SaveTemplate(){cleValidate(),$("#univarsalUpload").find("iframe").attr("src","%PHP_SELF%?savedata").load(function(){$("univarsalUpload").find("iframe").unbind("load");var a={fromname:$("#fromname").val(),frommail:$("#frommail").val(),replymail:$("#replymail").val(),subject:$("#tema").val(),type:$("#type").val(),additional:[],files:null,text:Base64.encode($("#text").val())};$(".additional").each(function(b,c){a.additional.push($(c).val())}),0!=attachedFiles.length&&(a.files=attachedFiles);var b=JSON.stringify(a);$("input[name=filename]",$(this).contents()).val("template.json"),$("textarea",$(this).contents()).val(b),$("form",$(this).contents()).submit()})}function AddField(a){$(a).parent().parent().after('<div class="col-sm-7 input-group extadd"><span class="input-group-addon">[ADD'+AddNum+']</span><input type="text" name="additional'+AddNum+'" id="additional'+AddNum+'" class="input-xlarge txtinput additional form-control" placeholder="%addfield2% '+AddNum+'"> <span class="input-group-addon"><span class="addfield" onclick="AddField(this)">+</span></span></div>'),$(a).parent().remove(),AddNum++}function textareaResizable(){("Chrome"==navigator.sayswho||"Opera"==navigator.sayswho)&&$("#resizableTextContainer").css({resizable:"vertical"})}function isetTimeout(a){var b=parseInt(a);timeoutNum=0>b?0:b>14400?14400:b}function MakeBold(){wrapText("text","<b>","</b>")}function MakeItalic(){wrapText("text","<i>","</i>")}function MakeUnderline(){wrapText("text","<u>","</u>")}function ReplaceEnum(a){return a}function MakeReverse(){var a=$("#text"),b=a[0].value.length,c=a[0].selectionStart,d=a[0].selectionEnd,e=a[0].value.substring(c,d);e=e.split("").reverse().join("");var f='<span style="direction: rtl;unicode-bidi: bidi-override;">'+e+"</span>";a[0].value=a[0].value.substring(0,c)+f+a[0].value.substring(d,b)}function wrapText(a,b,c){var d=$("#"+a),e=d[0].value.length,f=d[0].selectionStart,g=d[0].selectionEnd,h=d[0].value.substring(f,g),i=b+h+c;d[0].value=d[0].value.substring(0,f)+i+d[0].value.substring(g,e)}function showPreviewWindow(a){$("#preview-screen").find("iframe").attr("src",a),$(".section-screen").hide(),$("#preview-screen").show(),$(window).scrollTop(0)}function setLang(a){"ru"==a?(setCookie("translation","ru",{path:"/"}),document.location.reload()):(setCookie("translation",a,{path:"/"}),document.location.reload())}function setCookie(a,b,c){c=c||{};var d=c.expires;if("number"==typeof d&&d){var e=new Date;e.setTime(e.getTime()+1e3*d),d=c.expires=e}d&&d.toUTCString&&(c.expires=d.toUTCString()),b=encodeURIComponent(b);var f=a+"="+b;for(var g in c){f+="; "+g;var h=c[g];h!==!0&&(f+="="+h)}document.cookie=f}function cleValidate(){var a="Show Rich Text"==$(".cleditorButton:last").attr("title");a||window.cle.updateTextArea()}function cleToTextMode(a){var b="Show Rich Text"==$(".cleditorButton:last").attr("title");return a&&!b?void $(".cleditorButton:last").click():!a&&b?void $(".cleditorButton:last").click():void 0}function saveSettings(){var a={threads:threadNum,timeout:timeoutNum,randomTimeout:$("#randomTimeout").is(":checked"),maxDoneSize:maxDoneSize,useProxy:$("#use_proxy_server").is(":checked"),proxy:$("#proxy_server_uri").val(),useOutServers:$("#use_out_servers").is(":checked"),outServers:$("#out_servers").val(),sendInBackground:$("#sendInBackground").is(":checked"),sendInBase64:$("#sendInBase64").is(":checked"),saveLogInTxt:$("#saveLogInTxt").is(":checked")};$.post("%PHP_SELF%?saveSettings",{settings:JSON.stringify(a)},function(a){bootbox.alert(a)})}function removeSettings(){$.post("%PHP_SELF%?removeSettings",function(a){bootbox.alert(a);var b={threads:4,timeout:0,maxDoneSize:25,useProxy:!1,proxy:"",useOutServers:!1,outServers:"",sendInBase64:!1,saveLogInTxt:!1,randomTimeout:!1};applySettings(b)})}function loadSettings(){$.post("%PHP_SELF%?loadSettings",function(a){if(""!=a){var b=$.parseJSON(a);applySettings(b)}})}function applySettings(a){threadNum=a.threads,ShowThreads(),isetTimeout(a.timeout),$("#TIMEOUT").val(a.timeout),maxDoneSize=a.maxDoneSize,$("#maxDoneSize").val(a.maxDoneSize),$("#proxy_server_uri").val(a.proxy),$("#out_servers").val(a.outServers);var b={useProxy:"use_proxy_server",useOutServers:"use_out_servers",sendInBackground:"sendInBackground",sendInBase64:"sendInBase64",saveLogInTxt:"saveLogInTxt",randomTimeout:"randomTimeout"};for(var c in b)a[c]?($("#"+b[c]).prop("checked",!0),$("[data-toggle=#"+b[c]+"]").removeClass("btn-danger").addClass("btn-success").children("i").removeClass("glyphicon glyphicon-remove").addClass("glyphicon glyphicon-ok")):($("#"+b[c]).prop("checked",!1),$("[data-toggle=#"+b[c]+"]").removeClass("btn-success").addClass("btn-danger").children("i").removeClass("glyphicon glyphicon-ok").addClass("glyphicon glyphicon-remove"))}function selfDiagnostics(){$("#diagnostics-tab table").animate({opacity:0},"fast",function(){$.post("?selfDiagnostics",function(a){diagInfo=$.parseJSON(a),showDiagInfo(),$("#diagnostics-tab table").animate({opacity:1},"fast")})})}function showDiagInfo(){$("#diagnostics-tab tr").removeClass("diag-good diag-bad");for(var a in diagInfo){var b="";switch(typeof diagInfo[a]){case"boolean":b=diagInfo[a]?"%state_set%":"%state_unset%","shells_available"==a&&(b=diagInfo[a]?"%state_exist%":"%state_not_exist%"),"allow_url_fopen"==a&&(b=diagInfo[a]?"%state_allowed%":"%state_not_allowed%");break;default:b=diagInfo[a]}$("#diagnostics-tab ."+a).addClass(diagInfo[a]?"diag-good":"diag-bad").find("td:nth-child(2)").text(b)}diagInfo.file_is_writable?$("#settings-security-notwritable").hide():$("#settings-security-notwritable").show(),diagInfo.settings_is_writable?$("#settings-notwritable").hide():$("#settings-notwritable").show(),diagInfo.shells_available&&diagInfo.allow_url_fopen?$("#shells-notavalable").hide():$("#shells-notavalable").show(),diagInfo.bgfiles_is_writable?$("#send-in-background-notavalable").hide():$("#send-in-background-notavalable").show()}function mixToArchive(a,b,c){var d=[];for(var e in a)d.push(a[e]),0!=e&&e%c==0&&d.push(b);return d}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a))+a}var Done=[],maxDoneSize=25,toDo=[],additional=[],toDoSize=0,enumer=0,attachedFiles=[],outServers={active:!1,position:0,servers:[],servers_hash:"",updateServers:function(){if(this.servers_hash!=$("#out_servers").val()){this.servers_hash=$("#out_servers").val();var a=this.servers_hash.split("\n");this.servers=[];for(var b in a)a[b].length<3||this.servers.push(a[b]);this.position=0}},getServer:function(){this.position>=this.servers.length&&(this.position=0);var a=this.servers[this.position];return this.position++,a}},threadNum=4,timeoutNum=0,AddNum=1,status="stop",lastSendWasBackground=!0,diagInfo=null;window.navigator.sayswho=function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\bOPR\/(\d+)/),null!=a)?"Opera "+a[1]:(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),c[0])}(),window.uploadFinishedHandler=null,$(document).ready(function(){$("#prime, .prime-button").click(function(){$(".section-screen").hide(),$("#prime-screen").show()}),$("#help").click(function(){$(".section-screen").hide(),$("#help-screen").show()}),$("#settings").click(function(){$(".section-screen").hide(),$("#settings-screen").show()}),$(".btn-checkbox").click(function(){$(this).hasClass("btn-success")?($($(this).attr("data-toggle")).prop("checked",!1),$(this).removeClass("btn-success").addClass("btn-danger").children("i").removeClass("glyphicon glyphicon-ok").addClass("glyphicon glyphicon-remove")):($($(this).attr("data-toggle")).prop("checked",!0),$(this).removeClass("btn-danger").addClass("btn-success").children("i").removeClass("glyphicon glyphicon-remove").addClass("glyphicon glyphicon-ok"))}),"Chrome"==navigator.sayswho?window.cle=$("#text").cleditor({height:"auto"})[0]:(window.cle=$("#text").cleditor({height:200})[0],$("#resizableTextContainer").css({overflow:"hidden"}).attrchange({callback:function(){var a=$(this).height();$("#resizableTextContainer .cleditorMain").height(a-3),$("#resizableTextContainer .cleditorMain iframe").height(a-30)}})),$("#type").change(function(){cleToTextMode("text"==$(this).val()?!0:!1)}),$("#maxDoneSize").change(function(){maxDoneSize=$(this).val()}),$("#TIMEOUT").change(function(){isetTimeout($(this).val()),$("#TIMEOUT").val(timeoutNum)}),$("#THREADS").change(function(){var a=$(this).val();threadNum=1>a?1:a>100?100:a}),$("#timezone").change(function(){setCookie("timezone",$(this).val(),{path:"/"})}),$("#testEmailCounter").change(function(){var a=parseInt($(this).val());a>0?$("#testEmail").prop("readonly",!1):$("#testEmail").val("").prop("readonly",!0)}),$("[rel=tooltip]").tooltip(),ShowThreads(),loadSettings(),window.alexusMailerServiceMode||(updateBackgroundState(),window.backgroudStateChecker=setInterval(updateBackgroundState,5e3)),selfDiagnostics();try{serviceFunc()}catch(a){}}),String.prototype.replaceAll=function(a,b){return this.split(a).join(b)};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=Base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=Base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};